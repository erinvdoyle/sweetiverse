{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="sweet-detail-bg">
    <div class="container-xl py-5 sweet-detail-wrapper">

    <div class="row justify-content-center align-items-start g-5 flex-column flex-md-row">

      <!-- Sweet Image Card -->
      <div class="col-md-5 text-center">
        <div class="sweet-image-card">
          {% if sweet.image %}
            <a href="{{ sweet.image.url }}" target="_blank">
              <img src="{{ sweet.image.url }}" alt="{{ sweet.name }}" class="img-fluid sweet-image sparkle-float">
            </a>
          {% else %}
            <img src="{% static 'images/default.png' %}" alt="No image" class="img-fluid sweet-image">
          {% endif %}
        </div>
      </div>

      <!-- Sweet Info Card -->
      <div class="col-md-6">
        <div class="sweet-info styled-card p-4">
          <h2 class="logo-font sweet-text-highlight mb-3">{{ sweet.name }}</h2>
          <p><strong>Price:</strong> ¬£{{ sweet.price }}</p>
          {% if sweet.rating %}
            <p><strong>Rating:</strong> ‚≠ê {{ sweet.rating }}</p>
          {% endif %}
          {% if user.is_superuser %}
          <div class="mt-2">
            <a href="{% url 'edit_sweet' sweet.id %}" class="btn btn-sm btn-outline-primary">Edit</a>
            <a href="{% url 'delete_sweet' sweet.id %}" class="btn btn-sm btn-outline-danger">Delete</a>
          </div>
          {% endif %}
          <p class="mt-3"><strong>Description:</strong> {{ sweet.description }}</p>
          <p><strong>Ingredients:</strong> {{ sweet.ingredients }}</p>
          <p><strong>Country of Origin:</strong> {{ sweet.country_of_origin.name }}</p>
          <p><strong>Flavor:</strong> {{ sweet.flavor }}</p>
          <!-- Quantity + Form Centered -->
          <form method="POST" action="{% url 'add_to_bag' sweet.id %}" id="add-to-bag-form">
            {% csrf_token %}
            <input type="hidden" name="redirect_url" value="{{ request.path }}">
        
            <!-- Quantity Controls-->
            <div class="d-flex justify-content-center">
                <div class="d-flex align-items-center sweeti-quantity-form">
                    <button type="button" class="btn sweeti-qty-btn decrease-qty" data-input-id="qty-input-{{ sweet.id }}">
                        <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" name="quantity" value="1" min="1" max="99"
                           class="form-control sweeti-qty-input mx-2" id="qty-input-{{ sweet.id }}">
                    <button type="button" class="btn sweeti-qty-btn increase-qty" data-input-id="qty-input-{{ sweet.id }}">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
        

            <div class="text-center mt-3 px-2">
                <p class="sweetistravaganza-label d-inline-block px-3 py-2 mb-0">
                  üéâ SWEETiStravaganza: Buy 4 Sweetis, Get 1 FREE!
                </p>
              </div>
              
              

            <!-- Add to Bag -->
            <button type="submit" class="btn btn-primary mt-3 w-100 sweeti-add-btn">
                Add to Bag
            </button>
        </form>
        
  
        </div>
      </div>
    </div>

    <!-- Reviews -->
    <!-- <div class="sweeti-review-container">
        <div class="sweeti-review-bubble text-center">
        <h4 class="logo-font mb-3">üí¨ Sweeti Reviews</h4>
        <p>No reviews yet... Be the first to sprinkle your thoughts!</p>
        </div>
    </div> -->

    <!-- Review + Recommendations Section -->
<div class="sweeti-review-container">
    <!-- Recommendations Section -->
    <div class="sweeti-recommendations">
      <h4 class="logo-font mb-3">You Might Also Like...</h4>
      <div class="recommendation-cards">
        <!-- Mini Product Card 1 -->
        <div class="mini-product-card">
            <img src="/media/images/meiji_petitgum_grape_large.jpg" alt="Sweet 1" class="mini-product-img">
          <p class="mini-product-name">Grape Puccho</p>
        </div>
        <!-- Mini Product Card 2 -->
        <div class="mini-product-card">
            <img src="/media/images/big-sugar-rolly-rainbow-cotton-candy.webp" alt="Sweet 2" class="mini-product-img">
          <p class="mini-product-name">Kit Kat Matcha</p>
        </div>
      </div>
    </div>
  
    <!-- Review Bubble Section -->
    <div class="sweeti-review-bubble text-center">
      <h4 class="logo-font mb-3">üí¨ Sweeti Reviews</h4>
      <p>No reviews yet... Be the first to sprinkle your thoughts!</p>
    </div>
  </div>
  
    

  </div>
</div>

<!-- <script>
    document.addEventListener('DOMContentLoaded', function () {
      const qtyButtons = document.querySelectorAll('.increase-qty, .decrease-qty');
    
      function updateButtonState(input) {
        const value = parseInt(input.value);
        const increaseBtn = input.closest('.sweeti-quantity-form').querySelector('.increase-qty');
        const decreaseBtn = input.closest('.sweeti-quantity-form').querySelector('.decrease-qty');
    
        increaseBtn.disabled = value >= 99;
        decreaseBtn.disabled = value <= 1;
      }
    
      qtyButtons.forEach(button => {
        button.addEventListener('click', function () {
          const inputId = this.getAttribute('data-input-id');
          const input = document.getElementById(inputId);
          if (!input) return;
    
          let value = parseInt(input.value) || 1;
    
          if (this.classList.contains('increase-qty') && value < 99) {
            input.value = value + 1;
          } else if (this.classList.contains('decrease-qty') && value > 1) {
            input.value = value - 1;
          }
    
          updateButtonState(input);
        });
      });
    
      // Ensure correct button states on load
      document.querySelectorAll('.sweeti-qty-input').forEach(input => {
        updateButtonState(input);
    
        input.addEventListener('change', function () {
          let value = parseInt(input.value);
          if (isNaN(value) || value < 1) value = 1;
          if (value > 99) value = 99;
          input.value = value;
          updateButtonState(input);
        });
      });
    });
    </script> -->

{% block post_loadjs %}
  {{ block.super }}
  {% include "sweets/includes/quantity_update_script.html" %}
{% endblock %}
    
{% endblock %}

