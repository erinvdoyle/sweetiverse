{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container my-5">
  <h2 class="mb-4 text-center">üç≠ Build Your Pick-N-Mix Subscription!</h2>
  <form method="POST" class="p-4 bg-white rounded shadow-sm border">
    {% csrf_token %}

    <fieldset class="mb-4">
      <legend class="fw-bold mb-2">My Favorite Sweetis (Pick 1 or 2)</legend>
      <div class="d-flex flex-wrap">
        {% for checkbox in form.sweet_types %}
          <label class="btn btn-outline-pink me-2 mb-2">
            {{ checkbox.tag }} {{ checkbox.choice_label }}
          </label>
        {% endfor %}
      </div>
    </fieldset>

    <fieldset class="mb-4">
      <legend class="fw-bold mb-2">My Favorite Flavors (Pick 1 or 2)</legend>
      <div class="d-flex flex-wrap">
        {% for checkbox in form.flavor_preferences %}
          <label class="btn btn-outline-yellow me-2 mb-2">
            {{ checkbox.tag }} {{ checkbox.choice_label }}
          </label>
        {% endfor %}
      </div>
    </fieldset>

    <div class="form-check form-switch mb-4">
      {{ form.explorer }}
      <label class="form-check-label ms-2 fw-semibold">Include Sweeti Explorer? üåà (Surprise Picks!)</label>
    </div>

    <fieldset class="mb-4">
      <legend class="fw-bold mb-2">Choose Delivery Frequency</legend>
      <div class="d-flex flex-wrap">
        {% for radio in form.delivery_frequency %}
          <label class="btn btn-outline-green me-2 mb-2">
            {{ radio.tag }} {{ radio.choice_label }}
          </label>
        {% endfor %}
      </div>
    </fieldset>

    <div class="text-center">
      <button type="submit" class="btn btn-success btn-lg px-5">
        üíå Add to Bag & Checkout
      </button>
    </div>
  </form>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
      function limitChecks(selector, max) {
        document.querySelectorAll(selector).forEach(chk => {
          chk.addEventListener('change', () => {
            const checked = [...document.querySelectorAll(selector + ':checked')];
            if (checked.length > max) {
              chk.checked = false;
              alert(`Please select up to ${max} options.`);
            }
          });
        });
      }
      limitChecks('input[name="sweet_types"]', 2);
      limitChecks('input[name="flavor_preferences"]', 2);
    });
    </script>    
{% endblock %}

